<!doctype html>
<html lang="ro">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
  <meta name="theme-color" content="#0b0b0c" />
  <title>Trio SMS Menu</title>
  <style>
    :root{
      --bg:#0b0b0c;
      --text:#f3f3f4;
      --muted:#b8b8bc;
      --border:rgba(255,255,255,.10);
      --accent:rgba(255,215,0,.95);
      --radius:16px;
    }
    *{box-sizing:border-box;-webkit-tap-highlight-color:transparent}
    body{
      margin:0;
      font-family:-apple-system,BlinkMacSystemFont,"SF Pro Text","SF Pro Display",Segoe UI,Roboto,Helvetica,Arial,sans-serif;
      background:linear-gradient(180deg,#070708,var(--bg));
      color:var(--text);
    }
    .wrap{max-width:980px;margin:0 auto;padding:18px 14px 60px}
    header{
      position:sticky;top:0;z-index:10;
      background:rgba(11,11,12,.86);
      backdrop-filter:blur(18px);-webkit-backdrop-filter:blur(18px);
      border-bottom:1px solid var(--border);
      padding:10px 8px 14px;
      display:flex;flex-direction:column;gap:10px;
    }
    .toprow{display:flex;justify-content:space-between;gap:12px;align-items:flex-start}
    .h1{font-weight:700;font-size:20px;letter-spacing:.2px}
    .sub{color:rgba(255,255,255,.55);font-size:12px;margin-top:2px}
    .dest{color:rgba(255,255,255,.65);font-size:13px;white-space:nowrap}
    .search{display:flex;gap:10px;align-items:center}
    input[type="search"]{
      width:100%;
      background:rgba(255,255,255,.06);
      border:1px solid var(--border);
      border-radius:999px;
      padding:12px 14px;
      font-size:15px;
      color:var(--text);
      outline:none;
    }
    input[type="search"]::placeholder{color:rgba(255,255,255,.35)}
    .tabs{display:flex;gap:8px;flex-wrap:wrap}
    .tab{
      padding:10px 12px;border-radius:999px;
      border:1px solid var(--border);
      background:rgba(255,255,255,.04);
      color:rgba(255,255,255,.75);
      font-size:13px;
      cursor:pointer;
      user-select:none;
    }
    .tab.active{
      color:var(--text);
      background:rgba(255,215,0,.12);
      border-color:rgba(255,215,0,.20);
    }
    .tab.fav{display:flex;gap:6px;align-items:center}
    .section{margin-top:18px}
    .section h2{
      margin:0 0 10px;
      font-size:16px;font-weight:700;
      color:rgba(255,255,255,.85);
    }
    .grid{display:grid;grid-template-columns:repeat(2,minmax(0,1fr));gap:10px}
    @media(min-width:720px){.grid{grid-template-columns:repeat(3,minmax(0,1fr))}}
    @media(min-width:920px){.grid{grid-template-columns:repeat(4,minmax(0,1fr))}}
    button.card{
      width:100%;
      text-align:left;
      border:1px solid var(--border);
      background:rgba(255,255,255,.05);
      color:var(--text);
      border-radius:var(--radius);
      padding:12px 12px 10px;
      cursor:pointer;
      position:relative;
    }
    button.card:active{transform:scale(.99)}
    .row{display:flex;justify-content:space-between;gap:10px;align-items:flex-start}
    .title{font-weight:700;font-size:15px;line-height:1.1}
    .meta{margin-top:8px;display:flex;flex-wrap:wrap;gap:6px}
    .pill{
      display:inline-flex;
      align-items:center;
      border:1px solid var(--border);
      background:rgba(0,0,0,.18);
      padding:6px 8px;
      border-radius:999px;
      font-size:12px;
      color:rgba(255,255,255,.82);
      letter-spacing:.2px;
    }
    .star{
      width:26px;height:26px;border-radius:8px;
      border:1px solid var(--border);
      background:rgba(255,255,255,.04);
      display:flex;align-items:center;justify-content:center;
      font-size:16px;
      color:rgba(255,255,255,.65);
      flex:0 0 auto;
      cursor:pointer;
      user-select:none;
    }
    .star.on{color:var(--accent);border-color:rgba(255,215,0,.25);background:rgba(255,215,0,.10)}
    .hint{margin-top:14px;color:rgba(255,255,255,.45);font-size:12px}
    .footer{margin-top:18px;color:rgba(255,255,255,.35);font-size:12px}
    .hidden{display:none !important}
    .empty{color:var(--muted);font-size:13px;padding:6px 2px}

    /* --- Controls (Expeditor / Destinatar) --- */
    .controls{margin-top:10px;display:flex;flex-direction:column;gap:10px}
    .ctrlRow{display:flex;align-items:center;justify-content:space-between;gap:10px}
    .label{color:rgba(255,255,255,.55);font-size:12px;min-width:80px}
    .seg{display:flex;gap:6px}
    .seg button{
      border:1px solid var(--border);
      background:rgba(255,255,255,.06);
      color:var(--text);
      padding:8px 10px;
      border-radius:999px;
      font-size:13px;
      cursor:pointer;
    }
    .seg button.active{background:rgba(255,215,0,.14);border-color:rgba(255,215,0,.25)}
    .seg button:active{transform:scale(.99)}

    /* --- Pending bar --- */
    .pending{
      position:sticky;
      top:0;
      z-index:20;
      padding:10px 12px;
      border-radius:14px;
      border:1px solid var(--border);
      background:rgba(255,255,255,.06);
      backdrop-filter:blur(18px);
      -webkit-backdrop-filter:blur(18px);
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:10px;
    }
    .pendingBtns{display:flex;gap:8px}
    .pendingText{color:var(--text);font-size:13px}
    .pendingBtn{
      border:1px solid var(--border);
      background:rgba(255,255,255,.08);
      color:var(--text);
      padding:8px 10px;
      border-radius:999px;
      font-size:13px;
      cursor:pointer;
      white-space:nowrap;
    }
    .pendingBtn.secondary{background:transparent;color:rgba(255,255,255,.55)}
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <div class="toprow">
        <div>
          <div class="h1">Trio SMS Menu</div>
          <div class="sub">Alegi comanda → se deschide SMS-ul cu codul gata completat (apoi Send).</div>
        </div>

        <div class="controls">
          <div class="ctrlRow">
            <div class="label">Expeditor:</div>
            <div class="seg" role="group" aria-label="Expeditor">
              <button type="button" id="meRaul">Raul</button>
              <button type="button" id="meGina">Gina</button>
            </div>
          </div>

          <div class="ctrlRow">
            <div class="label">Destinatar:</div>
            <div class="seg" role="group" aria-label="Destinatar">
              <button type="button" id="toEve">Eve</button>
              <button type="button" id="toGina">Gina</button>
              <button type="button" id="toBoth">Ambele</button>
            </div>
          </div>

          <div id="pendingBar" class="pending hidden">
            <div class="pendingText" id="pendingText">Mai ai un mesaj de trimis.</div>
            <div class="pendingBtns">
              <button type="button" id="sendSecond" class="pendingBtn">Trimite acum</button>
              <button type="button" id="dismissSecond" class="pendingBtn secondary">Mai tarziu</button>
            </div>
          </div>
        </div>
      </div>

      <div class="search">
        <input id="q" type="search" placeholder="Cauta... (ex: O5, T-120, fatty, bolus 0.5, carbs 20)" oninput="applyFilter()" />
      </div>

      <div class="tabs">
        <div class="tab active" data-tab="all" onclick="setTab('all')">Toate</div>
        <div class="tab fav" data-tab="fav" onclick="setTab('fav')">⭐ Favorite</div>
        <div class="tab" data-tab="tt" onclick="setTab('tt')">Temp Target</div>
        <div class="tab" data-tab="ov" onclick="setTab('ov')">Override</div>
        <div class="tab" data-tab="bolus" onclick="setTab('bolus')">Bolus</div>
        <div class="tab" data-tab="carbs" onclick="setTab('carbs')">Carbs</div>
      </div>
    </header>

    <!-- FAVORITE -->
    <div class="section" id="secFav" data-section="fav">
      <h2>Favorite</h2>
      <div class="grid" id="favGrid"></div>
      <div id="favEmpty" class="empty hidden">Nu ai nimic in Favorite. Apasa pe ☆ la o comanda ca sa o salvezi.</div>
    </div>

    <!-- TEMP TARGET -->
    <div class="section" data-section="tt">
      <h2>Temp Target</h2>
      <div class="grid">
        <button class="card" data-section="tt" data-code="TTC" data-label="Temp Target Cancel" onclick="sendSMS('TTC')">
          <div class="row">
            <div class="title">Temp Target Cancel</div>
            <div class="star" role="button" aria-label="favorite" onclick="toggleFav(event,'TTC','Temp Target Cancel','tt')">☆</div>
          </div>
          <div class="meta"><span class="pill">TTC</span></div>
        </button>

        <button class="card" data-section="tt" data-code="T0" data-label="Hipo T-120(15%) / 20 min" onclick="sendSMS('T0')">
          <div class="row">
            <div class="title">Hipo T-120(15%) / 20 min</div>
            <div class="star" role="button" aria-label="favorite" onclick="toggleFav(event,'T0','Hipo T-120(15%) / 20 min','tt')">☆</div>
          </div>
          <div class="meta"><span class="pill">T0</span></div>
        </button>

        <button class="card" data-section="tt" data-code="T1" data-label="T-85(120%)" onclick="sendSMS('T1')">
          <div class="row">
            <div class="title">T-85(120%)</div>
            <div class="star" role="button" aria-label="favorite" onclick="toggleFav(event,'T1','T-85(120%)','tt')">☆</div>
          </div>
          <div class="meta"><span class="pill">T1</span></div>
        </button>

        <button class="card" data-section="tt" data-code="T2" data-label="T-90(120%)" onclick="sendSMS('T2')">
          <div class="row">
            <div class="title">T-90(120%)</div>
            <div class="star" role="button" aria-label="favorite" onclick="toggleFav(event,'T2','T-90(120%)','tt')">☆</div>
          </div>
          <div class="meta"><span class="pill">T2</span></div>
        </button>

        <button class="card" data-section="tt" data-code="T3" data-label="T-110(86%)" onclick="sendSMS('T3')">
          <div class="row">
            <div class="title">T-110(86%)</div>
            <div class="star" role="button" aria-label="favorite" onclick="toggleFav(event,'T3','T-110(86%)','tt')">☆</div>
          </div>
          <div class="meta"><span class="pill">T3</span></div>
        </button>

        <button class="card" data-section="tt" data-code="T4" data-label="T-120(75%)" onclick="sendSMS('T4')">
          <div class="row">
            <div class="title">T-120(75%)</div>
            <div class="star" role="button" aria-label="favorite" onclick="toggleFav(event,'T4','T-120(75%)','tt')">☆</div>
          </div>
          <div class="meta"><span class="pill">T4</span></div>
        </button>

        <button class="card" data-section="tt" data-code="T5" data-label="T-130(65%)" onclick="sendSMS('T5')">
          <div class="row">
            <div class="title">T-130(65%)</div>
            <div class="star" role="button" aria-label="favorite" onclick="toggleFav(event,'T5','T-130(65%)','tt')">☆</div>
          </div>
          <div class="meta"><span class="pill">T5</span></div>
        </button>

        <button class="card" data-section="tt" data-code="T6" data-label="T-140(57%)" onclick="sendSMS('T6')">
          <div class="row">
            <div class="title">T-140(57%)</div>
            <div class="star" role="button" aria-label="favorite" onclick="toggleFav(event,'T6','T-140(57%)','tt')">☆</div>
          </div>
          <div class="meta"><span class="pill">T6</span></div>
        </button>

        <button class="card" data-section="tt" data-code="T7" data-label="T-150(50%)" onclick="sendSMS('T7')">
          <div class="row">
            <div class="title">T-150(50%)</div>
            <div class="star" role="button" aria-label="favorite" onclick="toggleFav(event,'T7','T-150(50%)','tt')">☆</div>
          </div>
          <div class="meta"><span class="pill">T7</span></div>
        </button>

        <button class="card" data-section="tt" data-code="T8" data-label="T-160(45%)" onclick="sendSMS('T8')">
          <div class="row">
            <div class="title">T-160(45%)</div>
            <div class="star" role="button" aria-label="favorite" onclick="toggleFav(event,'T8','T-160(45%)','tt')">☆</div>
          </div>
          <div class="meta"><span class="pill">T8</span></div>
        </button>
      </div>
    </div>

    <!-- OVERRIDE -->
    <div class="section" data-section="ov">
      <h2>Override</h2>
      <div class="grid">
        <button class="card" data-section="ov" data-code="O0" data-label="Override Cancel" onclick="sendSMS('O0')">
          <div class="row">
            <div class="title">Override Cancel</div>
            <div class="star" role="button" aria-label="favorite" onclick="toggleFav(event,'O0','Override Cancel','ov')">☆</div>
          </div>
          <div class="meta"><span class="pill">O0</span></div>
        </button>
        <button class="card" data-section="ov" data-code="O5" data-label="Override 5" onclick="sendSMS('O5')">
          <div class="row">
            <div class="title">Override 5</div>
            <div class="star" role="button" aria-label="favorite" onclick="toggleFav(event,'O5','Override 5','ov')">☆</div>
          </div>
          <div class="meta"><span class="pill">O5</span></div>
        </button>
      </div>
    </div>

    <!-- BOLUS -->
    <div class="section" data-section="bolus">
      <h2>Bolus</h2>
      <div class="grid">
        <button class="card" data-section="bolus" data-code="B_05" data-label="bolus 0.5" onclick="sendSMS('B 0.5')">
          <div class="row">
            <div class="title">bolus 0.5</div>
            <div class="star" role="button" aria-label="favorite" onclick="toggleFav(event,'B_05','bolus 0.5','bolus')">☆</div>
          </div>
          <div class="meta"><span class="pill">B 0.5</span></div>
        </button>

        <button class="card" data-section="bolus" data-code="B_10" data-label="bolus 1.0" onclick="sendSMS('B 1.0')">
          <div class="row">
            <div class="title">bolus 1.0</div>
            <div class="star" role="button" aria-label="favorite" onclick="toggleFav(event,'B_10','bolus 1.0','bolus')">☆</div>
          </div>
          <div class="meta"><span class="pill">B 1.0</span></div>
        </button>

        <button class="card" data-section="bolus" data-code="B_15" data-label="bolus 1.5" onclick="sendSMS('B 1.5')">
          <div class="row">
            <div class="title">bolus 1.5</div>
            <div class="star" role="button" aria-label="favorite" onclick="toggleFav(event,'B_15','bolus 1.5','bolus')">☆</div>
          </div>
          <div class="meta"><span class="pill">B 1.5</span></div>
        </button>

        <button class="card" data-section="bolus" data-code="B_20" data-label="bolus 2.0" onclick="sendSMS('B 2.0')">
          <div class="row">
            <div class="title">bolus 2.0</div>
            <div class="star" role="button" aria-label="favorite" onclick="toggleFav(event,'B_20','bolus 2.0','bolus')">☆</div>
          </div>
          <div class="meta"><span class="pill">B 2.0</span></div>
        </button>
      </div>
    </div>

    <!-- CARBS -->
    <div class="section" data-section="carbs">
      <h2>Carbs</h2>
      <div class="grid">
        <button class="card" data-section="carbs" data-code="CH_10" data-label="carbs 10" onclick="sendSMS('10 CH')">
          <div class="row">
            <div class="title">carbs 10</div>
            <div class="star" role="button" aria-label="favorite" onclick="toggleFav(event,'CH_10','carbs 10','carbs')">☆</div>
          </div>
          <div class="meta"><span class="pill">10 CH</span></div>
        </button>

        <button class="card" data-section="carbs" data-code="CH_15" data-label="carbs 15" onclick="sendSMS('15 CH')">
          <div class="row">
            <div class="title">carbs 15</div>
            <div class="star" role="button" aria-label="favorite" onclick="toggleFav(event,'CH_15','carbs 15','carbs')">☆</div>
          </div>
          <div class="meta"><span class="pill">15 CH</span></div>
        </button>

        <button class="card" data-section="carbs" data-code="CH_20" data-label="carbs 20" onclick="sendSMS('20 CH')">
          <div class="row">
            <div class="title">carbs 20</div>
            <div class="star" role="button" aria-label="favorite" onclick="toggleFav(event,'CH_20','carbs 20','carbs')">☆</div>
          </div>
          <div class="meta"><span class="pill">20 CH</span></div>
        </button>

        <button class="card" data-section="carbs" data-code="CH_25" data-label="carbs 25" onclick="sendSMS('25 CH')">
          <div class="row">
            <div class="title">carbs 25</div>
            <div class="star" role="button" aria-label="favorite" onclick="toggleFav(event,'CH_25','carbs 25','carbs')">☆</div>
          </div>
          <div class="meta"><span class="pill">25 CH</span></div>
        </button>

        <button class="card" data-section="carbs" data-code="CH_35" data-label="carbs 35" onclick="sendSMS('35 CH')">
          <div class="row">
            <div class="title">carbs 35</div>
            <div class="star" role="button" aria-label="favorite" onclick="toggleFav(event,'CH_35','carbs 35','carbs')">☆</div>
          </div>
          <div class="meta"><span class="pill">35 CH</span></div>
        </button>

        <button class="card" data-section="carbs" data-code="CH_45_RB" data-label="45 RB" onclick="sendSMS('45 RB')">
          <div class="row">
            <div class="title">45 RB</div>
            <div class="star" role="button" aria-label="favorite" onclick="toggleFav(event,'CH_45_RB','45 RB','carbs')">☆</div>
          </div>
          <div class="meta"><span class="pill">45 RB</span></div>
        </button>

        <button class="card" data-section="carbs" data-code="CARBS_70" data-label="trio carbs 70" onclick="sendSMS('trio carbs 70')">
          <div class="row">
            <div class="title">trio carbs 70</div>
            <div class="star" role="button" aria-label="favorite" onclick="toggleFav(event,'CARBS_70','trio carbs 70','carbs')">☆</div>
          </div>
          <div class="meta"><span class="pill">CARBS_70</span></div>
        </button>
      </div>
      <div class="hint">iOS nu permite trimiterea automata a SMS-ului dintr-o pagina web; dupa deschidere, apesi tu Send.</div>
    </div>

    <div class="footer">Tip: Add to Home Screen ca sa se comporte ca o aplicatie (fara bara de adrese).</div>
  </div>

<script>
  // === Numere ===
  const RAUL_PHONE = "0745923843";
  const GINA_PHONE = "0757765345";
  const EVE_PHONE  = "0754628256";

  // Storage keys
  const SENDER_KEY  = "trio_sms_sender_v1";   // raul | gina (doar afisaj)
  const MODE_KEY    = "trio_sms_mode_v1";     // eve | gina | both
  const PENDING_KEY = "trio_sms_pending_v1";  // { to:"gina", code:"TTC" }

  const FAV_KEY = "trio_sms_favs_v1";
  let currentTab = "all";

  function loadFavs() {
    try {
      const raw = localStorage.getItem(FAV_KEY);
      const obj = raw ? JSON.parse(raw) : {};
      return (obj && typeof obj === "object") ? obj : {};
    } catch(e) { return {}; }
  }
  function saveFavs(favs) { localStorage.setItem(FAV_KEY, JSON.stringify(favs)); }

  let favs = loadFavs();

  function getSender(){ return localStorage.getItem(SENDER_KEY) || "raul"; }
  function setSender(v){ localStorage.setItem(SENDER_KEY, v); syncSenderUI(); }

  function getMode(){ return localStorage.getItem(MODE_KEY) || "both"; }
  function setMode(v){ localStorage.setItem(MODE_KEY, v); syncModeUI(); }

  function syncSenderUI(){
    const s = getSender();
    document.getElementById("meRaul")?.classList.toggle("active", s==="raul");
    document.getElementById("meGina")?.classList.toggle("active", s==="gina");
  }
  function syncModeUI(){
    const m = getMode();
    document.getElementById("toEve")?.classList.toggle("active", m==="eve");
    document.getElementById("toGina")?.classList.toggle("active", m==="gina");
    document.getElementById("toBoth")?.classList.toggle("active", m==="both");
    renderPendingBar();
  }

  function smsTo(number, code){
    const body = encodeURIComponent(code);
    window.location.href = `sms:${number}?&body=${body}`;
  }

  function getPending(){
    try { return JSON.parse(localStorage.getItem(PENDING_KEY) || "null"); }
    catch { return null; }
  }
  function clearPending(){
    localStorage.removeItem(PENDING_KEY);
    renderPendingBar();
  }

  function renderPendingBar(){
    const bar = document.getElementById("pendingBar");
    const txt = document.getElementById("pendingText");
    if (!bar || !txt) return;

    const p = getPending();
    if (!p){
      bar.classList.add("hidden");
      return;
    }
    const who = (p.to === "gina") ? "Gina" : "Eve";
    txt.textContent = `Mai ai de trimis acelasi mesaj catre ${who}.`;
    bar.classList.remove("hidden");
  }

  // Trimitere robusta:
  // - eve: direct Eve
  // - gina: direct Gina
  // - both: PAS 1 Eve, seteaza pending pentru Gina, PAS 2 optional manual
  function sendSMS(code) {
    const mode = getMode();

    if (mode === "eve") return smsTo(EVE_PHONE, code);
    if (mode === "gina") return smsTo(GINA_PHONE, code);

    // both
    localStorage.setItem(PENDING_KEY, JSON.stringify({ to:"gina", code }));
    renderPendingBar();
    return smsTo(EVE_PHONE, code);
  }

  function toggleFav(ev, code, label, section){
    ev.stopPropagation();
    if (favs[code]) delete favs[code];
    else favs[code] = { code, label, section };
    saveFavs(favs);
    syncStars();
    renderFavs();
    applyFilter();
  }

  function renderFavs(){
    const g = document.getElementById("favGrid");
    const e = document.getElementById("favEmpty");
    if (!g || !e) return;

    g.innerHTML = "";
    const a = Object.values(favs);
    if (!a.length){ e.classList.remove("hidden"); return; }
    e.classList.add("hidden");

    a.forEach(it=>{
      const d = document.createElement("button");
      d.className = "card";
      d.dataset.section = "fav";
      d.dataset.code = it.code;
      d.dataset.label = it.label;
      d.onclick = () => sendSMS(it.code);

      d.innerHTML = `
        <div class="row">
          <div class="title">${it.label}</div>
          <div class="star on" role="button" aria-label="favorite">★</div>
        </div>
        <div class="meta"><span class="pill">${it.code}</span></div>
      `;

      d.querySelector(".star").onclick = (ev) => toggleFav(ev, it.code, it.label, it.section);
      g.appendChild(d);
    });
  }

  function syncStars(){
    document.querySelectorAll(".card .star").forEach(s=>{
      const c = s.closest(".card")?.dataset.code;
      if (!c) return;
      const on = !!favs[c];
      s.classList.toggle("on", on);
      s.textContent = on ? "★" : "☆";
    });
  }

  function setTab(t){
    currentTab = t;
    document.querySelectorAll(".tab").forEach(x=>x.classList.toggle("active", x.dataset.tab===t));
    applyFilter();
  }

  function applyFilter(){
    const q = (document.getElementById("q")?.value || "").trim().toLowerCase();

    document.querySelectorAll(".section").forEach(sec => {
      const secName = sec.dataset.section;

      // Favorite section e vizibil doar in "fav" sau "all"
      if (secName === "fav"){
        const showFav = (currentTab === "fav" || currentTab === "all");
        sec.classList.toggle("hidden", !showFav);
        return;
      }

      const inTab = (currentTab === "all") || (secName === currentTab);
      if (!inTab) { sec.classList.add("hidden"); return; }

      let anyVisible = false;
      sec.querySelectorAll("button.card").forEach(btn => {
        const code = (btn.dataset.code || "").toLowerCase();
        const label = (btn.dataset.label || "").toLowerCase();
        const match = (!q) || (code + " " + label).includes(q);
        btn.classList.toggle("hidden", !match);
        if (match) anyVisible = true;
      });

      sec.classList.toggle("hidden", !anyVisible);
    });

    // Favorite grid filter
    const favGrid = document.getElementById("favGrid");
    if (favGrid && (currentTab === "fav" || currentTab === "all")){
      let anyFavVisible = false;
      favGrid.querySelectorAll("button.card").forEach(btn => {
        const code = (btn.dataset.code || "").toLowerCase();
        const label = (btn.dataset.label || "").toLowerCase();
        const match = (!q) || (code + " " + label).includes(q);
        btn.classList.toggle("hidden", !match);
        if (match) anyFavVisible = true;
      });
      document.getElementById("favEmpty")?.classList.toggle("hidden", Object.keys(favs).length > 0 && anyFavVisible);
    }
  }

  // UI listeners
  document.getElementById("meRaul")?.addEventListener("click", () => setSender("raul"));
  document.getElementById("meGina")?.addEventListener("click", () => setSender("gina"));

  document.getElementById("toEve")?.addEventListener("click", () => setMode("eve"));
  document.getElementById("toGina")?.addEventListener("click", () => setMode("gina"));
  document.getElementById("toBoth")?.addEventListener("click", () => setMode("both"));

  document.getElementById("sendSecond")?.addEventListener("click", () => {
    const p = getPending();
    if (!p) return;
    clearPending();
    smsTo(GINA_PHONE, p.code);
  });

  document.getElementById("dismissSecond")?.addEventListener("click", () => {
    document.getElementById("pendingBar")?.classList.add("hidden");
  });

  document.addEventListener("visibilitychange", () => {
    if (!document.hidden) renderPendingBar();
  });

  // init
  syncStars();
  renderFavs();
  syncSenderUI();
  syncModeUI();
  renderPendingBar();
  applyFilter();
</script>
</body>
</html>
